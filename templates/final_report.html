{% extends "base.html" %}
{% block content %}
    <link href="static/css/blog_post_1_style.css" rel="stylesheet" media="screen">
    <div class="row">
        <div class="col-md-2"></div>
        <div class="col-md-8">
            <div class="page-header center">
                <h1>Lineup Recommender <small>&laquo;Final Report&raquo;</small></h1>
            </div>

            <h2>Part 1: Overview and Hypothesis</h2>
            <p> FanDuel and DraftKings have one-day fantasy sports contests. For Basketball, the contests require the user to enter with a lineup of 9 players that are playing in the games for that day. People enter these contests everyday by paying a fixed amount of money. Once the day’s games are done, the users with the lineups containing the best performing players (calculated using a linear combination of their individual stats), win a huge amount of money.
            </p>
            <p>
            With the aim of doing well on the daily FanDuel contests, we hypothesized the following:
            <ul>
                <li>We can attain more than 90% accuracy given enough historical data and the right selection of features.</li>
                <li>Projecting individual stats that contribute to a player’s overall performance can be better than directly projecting the fanduel score because we can choose only the relevant features for each specific stat.</li>
            </ul>
            </p>
            <hr>

            <h2>Part 2: Data Collection</h2>
            <p> We are using data from 3 different sources:
            <ul>
                <li>NBA, which returns every player’s historical data
                <img class="img-responsive" src="static/images/nba_stats.png"><br>
                <img class="img-responsive" src="static/images/nba_data.png"</li>
                <li>NumberFire, which provides details about the players that are playing in today’s games
                <img class="img-responsive" src="static/images/nf_data.png"></li>
                <li>Stattleship, which has information about each player (like height, weight, etc.)
                <img class="img-responsive" src="static/images/ss_data.png"></li>
            </ul>

            The data displayed above is after combination and cleaning which involved the following steps:
            <ul>
                <li>Create id maps to match players between the three data sources.</li>
                <li>Accumulate data for the same player from different parts of each website.</li>
                <li>Remove games that the player did not play in.</li>
                <li>Remove bad values from gamelogs.</li>
            </ul>


            For every player, we collect the following information associated with that player:</p>
            <p>
                <ul>
                    <li>Gamelogs: a list of games they have played in, where each game has:
                        <ul>
                            <li>Time the game was held</li>
                            <li>Information on whether the game was played at home or away</li>
                            <li>The opponent team</li>
                            <li>Plus minus</li>
                            <li>How many times the player played in that game</li>
                            <li>Total rebounds score for the team the player is in</li>
                            <li>Total assists score</li>
                            <li>Total steals score</li>
                            <li>Total blocks score</li>
                            <li>Total turnovers score</li>
                            <li>Total points</li>
                        </ul>
                    </li>
                    <li>Position: a list of positions the player has, as some players have more than one position. For instance, Derek Williams plays in Point Forward and Small Forward.</li>
            </p>

            <h3>Challenges</h3>
            Data Processing:
            <ul>
                <li>Collecting  and combining the data from multiple sources (Stattleship, NumberFire and NBA) was time-consuming and complicated.</li>
                <li>Since player position can change per-game, we had no consistent source of per-game player position data. Ultimately, we decided to not use player position in our projection features.</li>
            </ul>

            Data Warehousing:
            <ul>
                <li>We originally stored the cleaned and transformed data into a hosted Redis database.</li>
                <li>Latency of requesting all player data ended up making our Redis database slower than using CSV files with our cleaned data.</li>
                <li>For our final projections, we switched back to locally hosted CSV files.</li>
            </ul>
            <hr>

            <h2>Part 3: Regression and Projection</h2>
            <p> We decided to compare 5 different kinds of regression algorithms, and compare their projections:
                <ul>
                    <li>A linear regressor</li>
                    <li>A Lasso regressor (linear model using L1 regularization) with an alpha of 0.1</li>
                    <li>A random forest regressor using 1000 estimators (trees) and max splits of sqrt(#-of-features)</li>
                    <li>A support vector regressor with linear kernel, using a penalty coefficient of 1 and epsilon of 0.1</li>
                    <li>A support vector regressor with RBF kernel, using a penalty coefficient of 1 and epsilon of 0.1</li>
                </ul>
            </p>
            <p> For training data, we decided to use the following features to project each game statistic independently:
            <img class="img-responsive" src="static/images/features_labels.png">
            </p>
            <p> 
                <ul>
                    <li>Our linear, Lasso, and random forest regressors were trained on all player game data from the past 4 seasons. </li>
                    <li>Our support vector regressors were trained on a single player’s game data (the player we are projecting) from the past 4 seasons. This was because SVM runtime is approximately O(#-of-observations2), forcing us to limit the number of training samples.</li>
                </ul>
            </p>

            <img class="img-responsive" src="static/images/regressor_barchart.png">

            <p>
                Grouped bar chart that displays the projected stats.
                <ul>
                    <li>RFR and SVR(Linear) consistently predicted higher than the others</li>
                    <li>Linear and Lasso were very similar in predictions</li>
                </ul>
    
            </p>
            <img class="img-responsive" src="static/images/regressor_table.png">
            <h4>Analysis</h4>
            <img class="img-responsive" src="static/images/r2_chart.png">

            <p>
                R^2 Chart for Stephen Curry:
                <ul>
                    <li>Both SVR projections have negative R^2 values, particularly with directly projecting fanduel scores. This is due to the low amount of training data used for SVR.</li>
                    <li>Other regressors are close to 0.4-0.5 R^2 scores, except when predicting steals, turnovers, and blocks. These three statistics are very dependent on opponents, and have high variance.</li>
                    <li>Other than the SVRs, RFR has the lowest R^2 scores for all projections</li>
                </ul>
                This suggests that using a linear regressor, with or without L1 regularization, has the best results for projecting.
            </p>
            <h3>Challenges</h3>
            Feature Flexibility:
            <ul>
                <li>We were not able to try all the different combinations of features we were hoping to for projections because it is very difficult to get data about new features. It might involve having to scrape a different website or page and cleaning and then adapting it to our existing data structures.</li>
            </ul>
            <hr>

            <h2>Part 4: Finding the Optimal Lineup</h2>
            <p>Fanduel has daily contests for the games that are occurring on that day. In the below image, you can see the information about one such contest.</p>
            <img class="img-responsive" src="static/images/fanduel_contest_information.png"></img>
            <p>As seen above, the user needs to pick 9 players (collectively called a lineup) from the 3 games to enter the contest with.<br>Below is an image of the screen after I built my lineup.</p>

            <img class="img-responsive" src="static/images/fanduel_contest_entry.png"></img>
            <p>Two details are important to understanding how a lineup works:
            <ol>
                <li>A player can be playing in one of these positions - Point Guard (PG), Shooting Guard (SG), Small Forward (SF), Power Forward (PF) or Center (C).</li>
                <li>Each player has a salary that is not their real salary but their fantasy salary assigned to them by Fanduel based on how well they have been performing.</li>
            </ol>

            </p>
            <p>
            Given the above information there are two constraints to keep in mind when creating the lineup:
            <ol>
                <li>The user needs to choose two players for each of the PG, SG, SF, and PF positions and one player for the C position. This adds up to a total of 9 players.</li>
                <li>The sum of the salaries of the 9 players cannot exceed the salary cap which in the above contest was $60,000 (it almost always is $60,000).</li>
            </ol>

            We first implemented the traditional dynamic programming approach to solving a knapsack problem. But, this does not take into account the additional constraints. After searching a lot for packages that might do this on python, we finally found openopt (a python module for numerical optimization). Although openopt is not documented online, we tinkered around a lot and finally got it to work with our constraints. Our optimal lineup for the games on April 18th is below. On looking back, this turned out to be the 37th best lineup for that day. This lineup would have won the user a significant amount of money on most contests.
            </p>
            <img class="img-responsive" src="static/images/optimal_lineup.png">

            <h3>Challenges</h3>
            Optimization:
            <ul>
                <li>Going over all possible lineups never finishes running because even on a day when just 50 players are playing there are a total of 2505433700 possible lineups. On most days there are more than 100 players which would be 1902231808400 lineups to go over.
                <li>Finding and working with openopt was very difficult and took a long time to figure out.</li>
            </ul>
            <hr>

            <h2>Part 5: Future Work</h2>
            <ul>
            <li>To improve the r-score, the current ideas we have are:
                <ol>
                    <li>Find a more specific set of data (like hustle stats, etc.) for predicting steals and blocks.
                    <li>Use rolling averages over games for more features (like minutes played and plus-minus).
                </ol>
            <li>Replace high salaried players with low salaried high variance players to beat out most traditional lineups.
            <li>Create a fully fledged website. Since we have a lineup optimizer in place, we can provide an optimzation tool on the webpage itself where any user can upload their own data and ask for the optimal lineup. We found a website that does this but funnily enough, they do not suggest the optimal lineup. Our program on the other hand did find the optimal lineup (the one with a total projected score of 289 as opposed to their 286).<br><br>
            <img class="img-responsive" src="static/images/rotoraider_lineup.png"><br>
            <img class="img-responsive" src="static/images/lineup-recommender_lineup.png">

            <!--<hr> In case you haven't noticed, this is a horizontal rule. It makes a horizontal line in the page. -->
        <div class="col-md-2"></div>
    </div> 
{% endblock %}